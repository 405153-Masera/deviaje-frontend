<div class="pt-4">
   <header class="results-header">
        <div class="container py-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="results-title">Hoteles en {{ destinationCity?.name }}{{locationService.getStateName(destinationCity)}} ({{destinationCity?.country}})</h1>
                    <div class="travel-info">
                        <span class="travel-dates">
                            <i class="bi bi-calendar3"></i>
                            {{ searchParams?.stay?.checkIn | date:'dd MMM' }} - {{ searchParams?.stay?.checkOut |
                            date:'dd MMM' }}
                        </span>
                        <span class="travel-guests">
                            <i class="bi bi-person"></i>
                            {{ getTotalGuests() }} {{ getTotalGuests() === 1 ? 'huésped' : 'huéspedes' }},
                            {{ getTotalRooms() }} {{ getTotalRooms() === 1 ? 'habitación' : 'habitaciones' }}
                        </span>
                    </div>
                </div>
                <div class="col-md-4 text-center text-md-end">
                    <button class="btn btn-secondary mt-2 mt-md-0" routerLink="/home/hotels/search">
                        Modificar búsqueda
                    </button>
                </div>
            </div>
        </div>
    </header>


    <div class="container">
        <div class="row">
            <!-- Filtros laterales (visible en desktop) -->

            <div class="col-lg-3 d-none d-lg-block filter-sidebar">
                <div class="filters-panel">
                    <div class="filters-header row">
                        <h2 class="filter-title col-12 col-xl-auto">Filtros</h2>
                        <button class="reset-filters-btn col-12 col-xl-auto" (click)="resetFilters()">
                            <i class="bi bi-arrow-counterclockwise"></i> Restablecer
                        </button>
                    </div>

                    <!-- Filtro de precio -->
                    <div class="filter-section">
                        <h3 class="filter-section-title">Precio</h3>
                        <div class="price-range">
                            <div class="price-slider mb-3">
                                <input type="range" class="form-range" min="{{ priceRange.min }}"
                                    max="{{ priceRange.max }}" [(ngModel)]="priceRange.current"
                                    (change)="applyFilters()">
                            </div>
                            <div class="price-labels d-flex justify-content-between flex-column">
                                <span>Desde: {{ priceRange.min |
                                    currency:(searchParams?.currency || 'USD') }}</span>
                                <span>Hasta: {{ priceRange.current |
                                    currency:(searchParams?.currency || 'USD') }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Filtro de categorías -->
                    <div class="filter-section">
                        <h6 class="filter-section-title">Categoría</h6>
                        @for (category of categoryFilters; track category.value) {
                        <div class="form-check py-1">
                            <input type="checkbox" class="form-check-input me-2" [id]="'cat-' + category.value"
                                [value]="category.value" [checked]="selectedCategories.includes(category.value)"
                                (change)="onCategoryChange(category.value, $event)">
                            <label class="form-check-label" [for]="'cat-' + category.value">
                                {{ category.label }}
                            </label>
                        </div>
                        }
                    </div>

                    <!-- Filtro de zonas -->
                    @if (zoneFilters.length > 0) {
                    <div class="filter-section">
                        <h6 class="filter-section-title">Zona</h6>
                        @for (zone of zoneFilters; track zone.value) {
                        <div class="form-check py-1">
                            <input type="checkbox" class="form-check-input me-2" [id]="'zone-' + zone.value"
                                [value]="zone.value" [checked]="selectedZones.includes(zone.value)"
                                (change)="onZoneChange(zone.value, $event)">
                            <label class="form-check-label" [for]="'zone-' + zone.value">
                                {{ zone.label }}
                            </label>
                        </div>
                        }
                    </div>
                    }
                </div>
            </div>

            <!-- Botón de filtros (visible en móvil) -->
            <div class="d-lg-none mobile-filter-toggle">
                <button class="btn btn-outline w-100 my-3" (click)="toggleFilters()">
                    <i class="bi bi-sliders"></i> Filtros
                </button>
            </div>

            <!-- Filtros móviles (oculto por defecto) -->
            <div class="mobile-filters" [class.show]="showFilters">
                <div class="mobile-filters-overlay" (click)="toggleFilters()"></div>
                <div class="mobile-filters-panel">
                    <div class="mobile-filters-header">
                        <h3>Filtros</h3>
                        <button class="close-filters-btn" (click)="toggleFilters()">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>

                    <div class="mobile-filters-content">
                        <!-- Filtro de precio -->
                        <div class="filter-section mb-3">
                            <h3 class="filter-section-title">Precio</h3>
                            <div class="price-range">
                                <div class="price-slider mb-2">
                                    <input type="range" class="form-range" min="{{ priceRange.min }}"
                                        max="{{ priceRange.max }}" [(ngModel)]="priceRange.current"
                                        (change)="applyFilters()">
                                </div>
                                <div class="price-labels d-flex justify-content-between flex-column">
                                    <span>Desde: {{ priceRange.min |
                                    currency:(searchParams?.currency || 'USD') }}</span>
                                    <span>Hasta: {{ priceRange.current |
                                        currency:(searchParams?.currency || 'USD') }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Filtro de categorías -->
                        <div class="filter-section mb-3">
                            <h3 class="filter-section-title">Categoría del hotel</h3>
                            <div class="categories-filter">
                                @for (category of categoryFilters; track category.value) {
                                <div class="form-check py-1">
                                    <input class="form-check-input me-2" type="checkbox"
                                        [id]="'mobile-cat-' + category.value" [value]="category.value"
                                        [checked]="selectedCategories.includes(category.value)"
                                        (change)="onCategoryChange(category.value, $event)">
                                    <label class="form-check-label" [for]="'mobile-cat-' + category.value">
                                        {{ category.label }}
                                    </label>
                                </div>
                                }
                            </div>
                        </div>

                        <!-- Filtro de zonas -->
                        @if (zoneFilters.length > 0) {
                        <div class="filter-section">
                            <h3 class="filter-section-title">Zona</h3>
                            <div>
                                @for (zone of zoneFilters; track zone.value) {
                                <div class="form-check py-1">
                                    <input class="form-check-input me-2" type="checkbox"
                                        [id]="'mobile-zone-' + zone.value" [value]="zone.value"
                                        [checked]="selectedZones.includes(zone.value)"
                                        (change)="onZoneChange(zone.value, $event)">
                                    <label class="form-check-label" [for]="'mobile-zone-' + zone.value">
                                        {{ zone.label }}
                                    </label>
                                </div>
                                }
                            </div>
                        </div>
                        }
                    </div>

                    <div class="mobile-filters-footer">
                        <button class="btn btn-outline-secondary" (click)="resetFilters()">
                            Restablecer
                        </button>
                        <button class="btn btn-primary" (click)="toggleFilters()">
                            Aplicar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Resultados de hoteles -->
            <div class="col-lg-9">
                <!-- Barra de ordenación -->
                <div class="sort-panel">
                    <div class="results-count">
                        {{ filteredHotels.length }} resultados encontrados
                    </div>
                    <div class="sort-options">
                        <label for="sortBy">Ordenar por:</label>
                        <select id="sortBy" class="form-select form-select-sm" [(ngModel)]="sortOption"
                            (change)="sortResults()">
                            <option value="price_asc">Precio (menor a mayor)</option>
                            <option value="price_desc">Precio (mayor a menor)</option>
                            <option value="name_asc">Nombre (A-Z)</option>
                        </select>
                    </div>
                </div>

                <!-- Estado de carga -->
                @if (isLoading) {
                <div class="loading-container">
                    <div class="spinner"></div>
                    <p>Buscando los mejores hoteles para ti...</p>
                </div>
                }

                <!-- Mensaje de error -->
                @if (hasError) {
                <div class="error-container">
                    <i class="bi bi-exclamation-triangle"></i>
                    <p>{{ errorMessage }}</p>
                    <button class="btn btn-primary" (click)="searchHotels()">
                        Intentar de nuevo
                    </button>
                </div>
                }

                <!-- Sin resultados -->
                @if (!isLoading && !hasError && paginatedHotels.length === 0) {
                <div class="no-results">
                    <i class="bi bi-x-circle"></i>

                    @if(searchResults && searchResults.hotels && searchResults.hotels.total > 0){
                        <p>No se encontraron hoteles que coincidan con los filtros seleccionados.</p>
                        <button class="btn btn-primary" (click)="resetFilters()">
                            Restablecer filtros
                        </button>
                    } @else {
                        <p>No se encontraron hoteles para el destino.</p>
                        <button class="btn btn-outline-secondary mt-2 mt-md-0" routerLink="/home/hotels/search">
                            Modificar búsqueda
                        </button>
                    }
                </div>
                }

                <!-- Lista de resultados -->
                @for (hotel of paginatedHotels; track hotel.code) {
                <div class="hotel-card">
                    <div class="row g-0">
                        <!-- Imagen del hotel -->
                        <div class="col-md-4">
                            <!-- Google Maps en lugar de imagen -->
                            <div class="hotel-map-container">
                                <iframe [src]="getGoogleMapsUrl(hotel)" class="hotel-map" frameborder="0"
                                    style="border:0;" allowfullscreen="" loading="lazy"
                                    referrerpolicy="no-referrer-when-downgrade">
                                </iframe>
                            </div>
                        </div>

                        <!-- Información del hotel -->
                        <div class="col-md-8">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <h5 class="card-title">{{ hotel.name }}</h5>

                                    <!-- Mostrar categoría con estrellas o badge -->
                                    @let display = getCategoryDisplay(hotel.categoryCode || '', hotel.categoryName
                                    ||'');

                                    <div class="hotel-category">
                                        @if (display.type === 'stars') {
                                        <div class="d-flex align-items-center">
                                            <div class="stars-container">
                                                @for (star of [].constructor(display.stars); track $index) {
                                                <i class="bi bi-star-fill text-warning"></i>
                                                }
                                                @if (display.isHalf) {
                                                <i class="bi bi-star-half text-warning"></i>
                                                }
                                            </div>
                                            @if (display.isLuxury) {
                                            <span class="badge rounded-pill bg-gold text-dark ms-2">LUJO</span>
                                            }
                                            @if (display.isSuperior) {
                                            <span class="badge rounded-pill bg-primary ms-2">SUPERIOR</span>
                                            }
                                        </div>
                                        }

                                        @if (display.type === 'badge') {
                                        <span class="badge rounded-pill" [ngClass]="display.badgeClass">
                                            {{ display.badgeText }}
                                        </span>
                                        }
                                    </div>
                                </div>

                                <p class="location">
                                    <i class="bi bi-geo-alt"></i> {{ hotel?.zoneName }},
                                    {{ hotel?.destinationName }}
                                </p>

                                <!-- Precio y acciones -->
                                <div class="price-booking mt-2">
                                    <div class="price">
                                        <div class="price-label">Precio desde</div>
                                        <div class="price-amount">
                                            @if (inPackageMode){
                                                {{ hotelService.convertToArs(getMinRoomPrice(hotel)) | currency:(searchParams?.currency || 'USD') }}
                                            } @else {
                                                {{ hotelService.getRateTotalWithCommission(getMinRoomPrice(hotel)) |
                                                    currency:(searchParams?.currency || 'USD') }}
                                            }
                                        </div>
                                        <div class="price-details">
                                            {{ getTotalGuests() }} {{ getTotalGuests() === 1 ? 'huésped' : 'huéspedes'}}
                                        </div>
                                    </div>

                                    <div class="action-buttons">
                                        @if (inPackageMode) {
                                        <button class="btn btn-primary" (click)="showHotelDetails(hotel)">
                                            Seleccionar
                                        </button>
                                        } @else {
                                        <button class="btn btn-info me-2" (click)="showHotelDetails(hotel)">
                                            <i class="bi bi-eye me-1"></i> Ver detalle
                                        </button>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                }

                <!-- Paginación -->
                @if (totalPages > 1) {
                <nav class="pagination-container">
                    <ul class="pagination">
                        <li class="page-item" [class.disabled]="currentPage === 1">
                            <a class="page-link" (click)="changePage(currentPage - 1)">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>

                        @for (page of getVisiblePages(); track $index) {
                        @if (isPageNumber(page)) {
                        <li class="page-item" [class.active]="currentPage === page">
                            <a class="page-link" (click)="changePage(page)">{{ page }}</a>
                        </li>
                        } @else {
                        <li class="page-item disabled">
                            <span class="page-link">{{ page }}</span>
                        </li>
                        }
                        }

                        <li class="page-item" [class.disabled]="currentPage === totalPages">
                            <a class="page-link" (click)="changePage(currentPage + 1)">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
                }
            </div>
        </div>
    </div>
</div>

<!-- Modal de detalles del hotel (para modo paquete) -->
@if (inPackageMode && showDetailModal && selectedHotelForDetail) {
<div class="hotel-detail-modal show">
    <div class="modal-overlay" (click)="closeDetailModal()"></div>
    <div class="modal-content">
        <app-deviaje-hotel-detail [inPackageMode]="true" [packageHotel]="selectedHotelForDetail"
            [packageSearchParams]="searchParams" (hotelAndRoomSelected)="onHotelAndRoomSelected($event)"
            [destinationCity]="destinationCity" (modalClosed)="closeDetailModal()">
        </app-deviaje-hotel-detail>
    </div>
</div>
}