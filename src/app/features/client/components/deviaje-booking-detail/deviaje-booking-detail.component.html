<div class="container my-4">

    <!-- Loading -->
    <div *ngIf="loading" class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body text-center py-5">
                    <div class="spinner-border text-primary"></div>
                    <p class="mt-3 text-muted">Cargando detalles de la reserva...</p>
                </div>
            </div>
        </div>
    </div>

    @if (error && !loading) {
    <div class="error-container">
        <i class="bi bi-exclamation-triangle"></i>
        <p>{{ error }}</p>
        <button class="btn btn-primary" (click)="goBack()">
            Volver
        </button>
    </div>
    }

    <!-- Contenido principal -->
    <div *ngIf="!loading && !error && bookingDetails">

        <!-- Header con acciones -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <div>
                        <h2 class="mb-1">Detalle de Reserva</h2>
                        <p class="text-muted mb-2">{{ bookingDetails.bookingReference }}</p>
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                        <button class="btn btn-outline-secondary" (click)="goBack()">
                            <i class="bi bi-arrow-left me-1"></i> Volver
                        </button>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-success" (click)="downloadVoucher()"
                                [disabled]="!canCancelBooking()">
                                <i class="bi bi-download me-1"></i> Descargar Voucher
                            </button>
                            <button class="btn btn-primary" (click)="resendVoucher()"
                                [disabled]="isSending || isSent || !canCancelBooking()">
                                <ng-container *ngIf="!isSending && !isSent">
                                    <i class="bi bi-envelope me-1"></i>Enviar por Email
                                </ng-container>
                                <ng-container *ngIf="isSending">Enviando...</ng-container>
                                <ng-container *ngIf="isSent">✔ Enviado</ng-container>
                            </button>
                            <button class="btn btn-danger" (click)="openCancelModal()" [disabled]="!canCancelBooking()">
                                <i class="bi bi-x-circle me-1"></i> Cancelar Reserva
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Alerta de error -->
        <div *ngIf="errorAlert" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {{ errorAlert }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"
                (click)="errorAlert = ''"></button>
        </div>

        <!-- Información general -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-info-circle me-2"></i>
                            Información General
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">

                            <div class="col-md-4">
                                <small class="text-muted d-block">Tipo de Reserva</small>
                                <span class="badge bg-secondary-subtle text-dark border fs-6">
                                    {{ getBookingTypeName(bookingDetails.type) }}
                                </span>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Estado</small>
                                <span class="badge fs-6" [ngClass]="getStatusBadgeClass(bookingDetails.status)">
                                    {{ getBookingStatusName(bookingDetails.status) }}
                                </span>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Fecha de Reserva</small>
                                <strong>{{ formatDate(bookingDetails.createdDatetime) }}</strong>
                            </div>


                            <div class="col-md-4">
                                <small class="text-muted d-block">Titular</small>
                                <strong>{{ bookingDetails.holderName }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Email</small>
                                <strong>{{ bookingDetails.email }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Teléfono</small>
                                <strong>{{ bookingDetails.countryCallingCode }} {{ bookingDetails.phone }}</strong>
                            </div>

                        </div>

                        <!-- Desglose de precios -->
                        <hr class="my-3">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <small class="text-muted d-block">Monto Total</small>
                                <strong class="text-success fs-5">
                                    {{ bookingDetails.totalAmount | currency:'ARS' }}
                                </strong>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted d-block">Subtotal</small>
                                <strong>{{ bookingDetails.totalAmount - bookingDetails.taxes -
                                    bookingDetails.commission| currency:'ARS' }}</strong>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted d-block">Impuestos</small>
                                <strong>{{ bookingDetails.taxes | currency:'ARS' }}</strong>
                            </div>
                            <div class="col-md-3" *ngIf="bookingDetails.discount > 0">
                                <small class="text-muted d-block">Descuento</small>
                                <strong class="text-danger">-{{ bookingDetails.discount | currency:'ARS'}}</strong>
                            </div>
                            <div class="col-md-3" *ngIf="bookingDetails.commission > 0">
                                <small class="text-muted d-block">Comisión</small>
                                <strong>{{ bookingDetails.commission | currency:'ARS' }}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detalles de VUELO -->
        <div class="row mb-4" *ngIf="bookingDetails.flightDetails">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-airplane me-2"></i>
                            Detalles del Vuelo
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">

                            @if(bookingDetails.type === 'PACKAGE') {
                            <div class="col-md-3">
                                <small class="text-muted d-block">Origen</small>
                                <strong class="fs-5">{{ bookingDetails.flightDetails.origin }}</strong>
                            </div>

                            <div class="col-md-3">
                                <small class="text-muted d-block">Destino</small>
                                <strong class="fs-5">{{ bookingDetails.flightDetails.destination }}</strong>
                            </div>

                            <div class="col-md-3">
                                <small class="text-muted d-block">Aerolínea</small>
                                <strong>{{ getAirlineName(bookingDetails.flightDetails.carrier) }}</strong>
                            </div>

                            <div class="col-md-3">
                                <small class="text-muted d-block">Precio Vuelo</small>
                                <strong>{{ bookingDetails.flightDetails.totalPrice | currency: 'ARS'}}</strong>
                            </div>

                            } @else {
                            <div class="col-md-4">
                                <small class="text-muted d-block">Origen</small>
                                <strong class="fs-5">{{ bookingDetails.flightDetails.origin }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Destino</small>
                                <strong class="fs-5">{{ bookingDetails.flightDetails.destination }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Aerolínea</small>
                                <strong>{{ getAirlineName(bookingDetails.flightDetails.carrier) }}</strong>
                            </div>
                            }

                            <div class="col-md-4">
                                <small class="text-muted d-block">Salida</small>
                                <strong>{{ formatSimpleDate(bookingDetails.flightDetails.departureDate) }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Regreso</small>
                                <strong>{{ formatSimpleDate(bookingDetails.flightDetails.returnDate) }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Total Pasajeros</small>
                                <strong>{{ getTotalPassengers() }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Adultos</small>
                                <strong>{{ bookingDetails.flightDetails.adults }}</strong>
                            </div>

                            <div class="col-md-4" *ngIf="bookingDetails.flightDetails.children > 0">
                                <small class="text-muted d-block">Niños</small>
                                <strong>{{ bookingDetails.flightDetails.children }}</strong>
                            </div>

                            <div class="col-md-4" *ngIf="bookingDetails.flightDetails.infants > 0">
                                <small class="text-muted d-block">Infantes</small>
                                <strong>{{ bookingDetails.flightDetails.infants }}</strong>
                            </div>

                        </div>

                        <!-- Itinerarios -->
                        <div *ngIf="bookingDetails.flightDetails.itineraries" class="mb-4 mt-5">
                            <h5 class="text-primary mb-3">Itinerarios</h5>

                            <div *ngFor="let itinerary of bookingDetails.flightDetails.itineraries; let i = index"
                                class="mb-4">

                                <div class="d-flex align-items-center mb-3">
                                    <span class="badge bg-primary me-2">
                                        {{ i === 0 ? 'Ida' : 'Vuelta' }}
                                    </span>
                                </div>

                                <!-- Segmentos del itinerario -->
                                <div *ngFor="let segment of itinerary.segments; let isLast = last"
                                    class="border rounded p-3 mb-2 bg-light">

                                    <div class="row align-items-center">
                                        <!-- Salida -->
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <i class="bi bi-airplane-fill text-primary me-2"></i>
                                                <div>
                                                    <strong class="d-block">{{
                                                        getAirportName(segment.departure.iataCode) }}</strong>
                                                    <small class="text-muted d-block">
                                                        {{ formatFlightDate(segment.departure.at) }}
                                                    </small>
                                                    <strong class="text-primary">
                                                        {{ formatFlightTime(segment.departure.at) }}
                                                    </strong>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Duración y aerolínea -->
                                        <div class="col-md-3 text-center">
                                            <small class="text-muted d-block">{{ formatDuration(segment.duration)
                                                }}</small>
                                            <div class="border-top border-2 border-primary my-1"></div>
                                            <small class="text-muted">
                                                {{ getAirlineName(segment.carrierCode) }}
                                            </small>
                                        </div>

                                        <!-- Llegada -->
                                        <div class="col-md-3 text-end">
                                            <div class="d-flex align-items-center justify-content-end">
                                                <div class="text-end me-2">
                                                    <strong class="d-block">{{ getAirportName(segment.arrival.iataCode)
                                                        }}</strong>
                                                    <small class="text-muted d-block">
                                                        {{ formatFlightDate(segment.arrival.at) }}
                                                    </small>
                                                    <strong class="text-primary">
                                                        {{ formatFlightTime(segment.arrival.at) }}
                                                    </strong>
                                                </div>
                                                <i class="bi bi-geo-alt-fill text-danger"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pasajeros -->
                        <div *ngIf="bookingDetails.flightDetails.travelers" class="mt-4">
                            <h5 class="text-primary mb-3">Pasajeros</h5>

                            <div class="row g-3">
                                <div *ngFor="let traveler of bookingDetails.flightDetails.travelers; let i = index"
                                    class="col-md-4">
                                    <div class="card border">
                                        <div class="card-body">
                                            <div class="d-flex align-items-start">
                                                <i class="bi bi-person-circle fs-4 text-primary me-3"></i>
                                                <div class="flex-grow-1">
                                                    <strong class="d-block">
                                                        {{ traveler.name.firstName }} {{ traveler.name.lastName }}
                                                    </strong>
                                                    <small class="text-muted d-block">
                                                        <span *ngIf="traveler.dateOfBirth">
                                                            {{ calculateAge(traveler.dateOfBirth) }} años
                                                        </span>
                                                        <span *ngIf="!traveler.dateOfBirth">
                                                            {{ traveler.travelerType === 'ADULT' ? 'Adulto' :
                                                            traveler.travelerType === 'CHILD' ? 'Niño' : 'Infante' }}
                                                        </span>
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Políticas de cancelación de vuelo -->
                        <div class="mt-4" *ngIf="getFlightCancellationPolicy()">
                            <h6 class="text-primary mb-3">
                                Políticas de Cancelación
                            </h6>

                            <div class="card border">
                                <div class="card-body">

                                    <!-- Si puede cancelar gratis -->
                                    <div *ngIf="getFlightCancellationPolicy()?.canCancel"
                                        class="alert alert-success mb-0">
                                        <i class="bi bi-check-circle-fill me-2"></i>
                                        <strong>¡Cancelación gratuita disponible!</strong>
                                        <p class="mb-0 mt-2">
                                            <small>{{ getFlightCancellationPolicy()?.message }}</small>
                                        </p>
                                    </div>

                                    <!-- Si NO puede cancelar gratis -->
                                    <div *ngIf="!getFlightCancellationPolicy()?.canCancel">
                                        <div class="alert alert-warning mb-3">
                                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                            <strong>Tarifa no reembolsable</strong>
                                        </div>

                                        <div class="mb-3">
                                            <small class="text-muted d-block mb-2">
                                                <strong>Condiciones de cancelación:</strong>
                                            </small>
                                            <ul class="mb-0">
                                                <li class="mb-2">
                                                    <small>
                                                        <i class="bi bi-check-circle text-success me-1"></i>
                                                        <strong>Reembolso total:</strong> Solo si cancelás dentro de las
                                                        24 horas de hecha la reserva
                                                        Y faltan más de 24 horas para la salida del vuelo.
                                                    </small>
                                                </li>
                                                <li>
                                                    <small>
                                                        <i class="bi bi-x-circle text-danger me-1"></i>
                                                        <strong>No reembolsable:</strong> En cualquier otro caso
                                                        (después de 24hs de la reserva o
                                                        si el vuelo sale en menos de 24hs).
                                                    </small>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div class="alert alert-info mb-0">
                                        <small>
                                            <i class="bi bi-info-circle me-2"></i>
                                            <strong>Nota importante:</strong> La comisión de agencia no es reembolsable
                                            en ningún caso.
                                        </small>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Detalles de HOTEL -->
        <div class="row mb-4" *ngIf="bookingDetails.hotelDetails">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="bi bi-building me-2"></i>
                            Detalles del Hotel
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            @if(bookingDetails.type === 'PACKAGE') {
                            <div class="col-md-4">
                                <small class="text-muted d-block">Hotel</small>
                                <strong class="fs-5">{{ bookingDetails.hotelDetails.hotelName }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Ubicación</small>
                                <strong>{{ bookingDetails.hotelDetails.destinationName }}, {{
                                    bookingDetails.hotelDetails.countryName }}</strong>
                            </div>
                            <div class="col-md-4">
                                <small class="text-muted d-block">Precio Hotel</small>
                                <strong>{{ bookingDetails.hotelDetails.totalPrice | currency: 'ARS'}} </strong>
                            </div>
                            } @else {
                            <div class="col-md-6">
                                <small class="text-muted d-block">Hotel</small>
                                <strong class="fs-5">{{ bookingDetails.hotelDetails.hotelName }}</strong>
                            </div>

                            <div class="col-md-6">
                                <small class="text-muted d-block">Ubicación</small>
                                <strong>{{ bookingDetails.hotelDetails.destinationName }}, {{
                                    bookingDetails.hotelDetails.countryName }}</strong>
                            </div>
                            }

                            <div class="col-md-4">
                                <small class="text-muted d-block">Check-in</small>
                                <strong>{{ formatDate(bookingDetails.hotelDetails.checkInDate) }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Check-out</small>
                                <strong>{{ formatSimpleDate(bookingDetails.hotelDetails.checkOutDate) }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Noches</small>
                                <strong>{{ bookingDetails.hotelDetails.numberOfNights }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Habitación</small>
                                <strong>{{ bookingDetails.hotelDetails.roomName }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Régimen de Comidas</small>
                                <strong>{{ bookingDetails.hotelDetails.boardName }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Habitaciones</small>
                                <strong>{{ bookingDetails.hotelDetails.numberOfRooms }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Adultos</small>
                                <strong>{{ bookingDetails.hotelDetails.adults }}</strong>
                            </div>

                            <div class="col-md-4" *ngIf="bookingDetails.hotelDetails.children > 0">
                                <small class="text-muted d-block">Niños</small>
                                <strong>{{ bookingDetails.hotelDetails.children }}</strong>
                            </div>

                            <div class="col-md-4">
                                <small class="text-muted d-block">Total Huéspedes</small>
                                <strong>{{ getTotalGuests() }}</strong>
                            </div>

                        </div>

                        <!-- Detalles adicionales del hotel desde API -->
                        <div *ngIf="bookingDetails.hotelDetails.hotelBooking" class="mt-4">

                            <!-- Huéspedes -->
                            <div class="mb-4" *ngIf="bookingDetails.hotelDetails.hotelBooking.hotel.rooms[0].paxes">
                                <h6 class="text-primary mb-3">Huéspedes</h6>
                                <div class="row g-2">
                                    <div *ngFor="let pax of bookingDetails.hotelDetails.hotelBooking.hotel.rooms[0].paxes"
                                        class="col-md-4">
                                        <div class="card border">
                                            <div class="card-body p-2">
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-person-fill text-primary me-2"></i>
                                                    <div>
                                                        <strong class="d-block">{{ pax.name }} {{ pax.surname
                                                            }}</strong>
                                                        <small class="text-muted">
                                                            {{ pax.type === 'AD' ? 'Adulto' :
                                                            pax.type === 'CH' ? 'Niño' : 'Infante' }}
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Comentarios de la tarifa -->
                            <div class="mb-4"
                                *ngIf="bookingDetails.hotelDetails.hotelBooking.hotel.rooms[0].rates[0].rateComments">
                                <h6 class="text-primary mb-3">Información de la Tarifa</h6>
                                <div class="alert alert-info mb-0">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <span>{{
                                        bookingDetails.hotelDetails.hotelBooking.hotel.rooms[0].rates[0].rateComments
                                        }}</span>
                                </div>
                            </div>

                            <!-- Políticas de cancelación -->
                            <div
                                *ngIf="bookingDetails.hotelDetails.hotelBooking.hotel.rooms[0]?.rates?.[0]?.cancellationPolicies">
                                <h6 class="text-primary mb-3">Políticas de Cancelación</h6>
                                <div class="alert alert-warning">
                                    <div *ngFor="let policy of bookingDetails.hotelDetails.hotelBooking.hotel.rooms[0].rates[0].cancellationPolicies"
                                        class="mb-2">
                                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                        <strong>Desde:</strong> {{ formatDate(policy.from) }}
                                        <br>
                                        <span class="ms-4">
                                            <strong>Cargo:</strong>
                                            {{ hotelService.convertToArs(policy.amount) | currency:'ARS' }}
                                            <small class="text-muted d-block">(La comisión no es reembolsable)</small>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========== MODAL DE CANCELACIÓN ========== -->
<div class="modal fade" [class.show]="showCancelModal" [style.display]="showCancelModal ? 'block' : 'none'"
    tabindex="-1">

    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Header -->
            <div class="modal-header">
                <h5 class="modal-title">Cancelar Reserva</h5>
                <button type="button" class="btn-close" (click)="closeCancelModal()" [disabled]="isProcessingCancel">
                </button>
            </div>

            <!-- Body -->
            <div class="modal-body">

                <!-- Mensaje de éxito -->
                <div *ngIf="showSuccessMessage" class="alert alert-success">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    {{ successMessage }}
                </div>

                <!-- Formulario (oculto si hay mensaje de éxito) -->
                <form [formGroup]="cancelForm" *ngIf="!showSuccessMessage">

                    <!-- Información de la reserva -->
                    <div class="alert alert-info">
                        <strong>Reserva:</strong> {{ bookingDetails?.bookingReference }}<br />
                        <strong>Tipo:</strong> {{ getBookingTypeName(bookingDetails?.type || '') }}
                    </div>

                    <!-- Información de reembolso -->
                    <div class="alert" [class.alert-success]="calculatedRefund > 0"
                        [class.alert-warning]="calculatedRefund === 0">
                        <strong>Monto a reembolsar:</strong>
                        {{ calculatedRefund > 0 ? (calculatedRefund | currency:'ARS') : 'No reembolsable' }}
                        <br />
                        <small class="text-muted">
                            La comisión de agencia no es reembolsable.
                        </small>
                    </div>

                    <!-- Motivo de cancelación -->
                    <div class="mb-3">
                        <label for="cancellationReason" class="form-label">
                            Motivo de cancelación <span class="text-danger">*</span>
                        </label>
                        <select id="cancellationReason" class="form-select" formControlName="cancellationReason"
                            [class.is-invalid]="isFieldInvalid('cancellationReason')" [disabled]="isProcessingCancel">
                            <option value="">Selecciona un motivo</option>
                            <option *ngFor="let reason of cancellationReasons" [value]="reason.value">
                                {{ reason.label }}
                            </option>
                        </select>
                        <div class="invalid-feedback" *ngIf="isFieldInvalid('cancellationReason')">
                            {{ getFieldError('cancellationReason') }}
                        </div>
                    </div>

                    <!-- Detalles adicionales -->
                    <div class="mb-3" *ngIf="cancelForm.get('cancellationReason')?.value === 'otro'">
                        <label for="additionalDetails" class="form-label">
                            Especifica el motivo <span class="text-danger">*</span>
                        </label>
                        <textarea id="additionalDetails" class="form-control" rows="3"
                            formControlName="additionalDetails" [class.is-invalid]="isFieldInvalid('additionalDetails')"
                            [disabled]="isProcessingCancel"
                            placeholder="Explica brevemente el motivo de cancelación (mínimo 10 caracteres)...">
                         </textarea>
                        <div class="invalid-feedback" *ngIf="isFieldInvalid('additionalDetails')">
                            {{ getFieldError('additionalDetails') }}
                        </div>
                    </div>

                    <!-- Error general -->
                    <div *ngIf="cancelErrorMessage" class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        {{ cancelErrorMessage }}
                    </div>

                    <!-- Advertencia -->
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Atención:</strong> Esta acción no se puede deshacer.
                        <span *ngIf="calculatedRefund > 0">
                            El reembolso será procesado en 5-10 días hábiles.
                        </span>
                    </div>

                </form>

            </div>

            <!-- Footer -->
            <div class="modal-footer" *ngIf="!showSuccessMessage">
                <button type="button" class="btn btn-outline-secondary" (click)="closeCancelModal()"
                    [disabled]="isProcessingCancel">
                    Cerrar
                </button>
                <button type="button" class="btn btn-danger" (click)="confirmCancelBooking()"
                    [disabled]="cancelForm.invalid || isProcessingCancel">
                    <span *ngIf="isProcessingCancel">
                        <span class="spinner-border spinner-border-sm me-1"></span>
                        Cancelando...
                    </span>
                    <span *ngIf="!isProcessingCancel">
                        <i class="bi bi-check-circle me-1"></i>
                        Confirmar Cancelación
                    </span>
                </button>
            </div>

        </div>
    </div>
</div>

<!-- Backdrop del modal -->
<div class="modal-backdrop fade" [class.show]="showCancelModal" *ngIf="showCancelModal">
</div>

<!-- ========== ALERT DE ÉXITO GLOBAL (para resend voucher) ========== -->
<div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 9999;">
    <div *ngIf="showSuccessMessage && !showCancelModal" class="alert alert-success alert-dismissible fade show"
        role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        {{ successMessage }}
        <button type="button" class="btn-close" (click)="showSuccessMessage = false">
        </button>
    </div>
</div>